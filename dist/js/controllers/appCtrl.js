!function(){"use strict";function t(t,e,n,r,o,s,a){function i(){r.getByUserId(t.user.id).then(c)}function u(t){var e={title:"Teste em progresso!",text:"Você já tem um teste em progresso. Deseja continuá-lo?",type:"warning",showCancelButton:!0,cancelButtonText:"Novo teste",confirmButtonText:"Continuar",confirmButtonColor:"#2c3e50"};n.swal(e,function(e){e?f(t):h(t)})}function c(t){var e=d(t);e?u(e):l()}function l(){var t={title:"Boa sorte!",text:"Vamos lá, mostre o seu melhor! ;)",imageUrl:"./img/luck.png",confirmButtonText:"Partiu",confirmButtonColor:"#2c3e50"};n.swal(t,p)}function d(t){function e(t){t.completedOn||(n=t.id)}var n;return t.forEach(e),n}function f(t){r.getById(t).then(g)}function g(e){e&&(t.test=angular.copy(e),o.getByTestId(e.id).then(w))}function w(e){t.answers=angular.copy(e),B()}function h(e){t.test={id:e,userId:t.user.id},o.deleteByTestId(e).then(m)}function p(){t.test={userId:t.user.id},r.add(t.test).then(function(e){t.test=angular.copy(e),m()})}function m(){s.getAll().then(function(e){var n=a.generateRandomArray(e.length),r=[];n.forEach(function(n,o){var s={testId:t.test.id,questionId:e[n].id,time:0,order:o+1};r.push(s)}),o.addAll(r).then(v)})}function v(e){t.answers=e;var n={id:t.test.id,total:t.answers.length};r.update(n).then(function(){y(e[0].id)})}function y(n){var r=0;t.answers.forEach(function(t){t.answer&&r++});var o={answerId:n,answered:r,total:t.answers.length};e.go("test",o)}function B(){var e,n=0;if(t.answers.length){for(;!(e||n>=t.answers.length);)null==t.answers[n].answer&&(e=t.answers[n].id),n++;e?y(e):C()}else m()}function I(){var e=0;return t.answers.forEach(function(t){t.right&&e++}),e}function C(){var e=I(),n=a.getPercetange(e,t.answers.length),o={id:t.answers[0].testId,completedOn:new Date,percentage:n,right:e};r.update(o).then(S)}function S(){e.go("testCompleted",{testId:t.test.id})}t.user={},t.test={},t.$on("userSelected",function(e,n){t.user=angular.copy(n),i()}),t.$on("questionAnswered",function(e,n){function r(e,r){e.id==n.id&&(t.answers[r]=angular.copy(n))}t.answers.forEach(r),B()})}app.controller("appCtrl",t),t.$inject=["$scope","$state","SweetAlert","testService","answerService","questionService","utilService"]}();